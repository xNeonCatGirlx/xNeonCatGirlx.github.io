<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Synthwave Rain ✨</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Honk&family=Rajdhani:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
  <link rel="stylesheet" href="./style.css">
  <style>
    .walls {
      height: 100vh;
      width: 100vw;
      position: relative;
      overflow: hidden;
    }
  </style>
</head>
<body>
  <div class="walls"></div>
  <script>
    const kanas = ['ﾆ','ﾜ','ﾒ','ｼ','ｻ','ﾘ','ｳ','ﾗ','ｵ','ｴ','ｱ','ｾ','ﾊ','ｹ','ｰ','ﾃ','ｷ','ﾋ','ﾍ','ﾑ','ﾕ','ｽ','ﾏ'];
    const walls = document.querySelector('.walls');
    const numWalls = 14;
    const numColumns = 30;
    const dropsPerVariant = 15;
    const variantsPerColumn = 2;
    const maxColumnsPerWall = 20;

    function randDec() {
      return +(Math.random().toFixed(10));
    }

    function spawnColumn(columnIndex) {
      const column = document.createElement('div');
      column.className = 'column';
      column.style.setProperty('--r0', randDec());
      column.style.setProperty('--r1', randDec());
      column.style.setProperty('--r2', randDec());

      for (let v = 0; v < variantsPerColumn; v++) {
        const variant = document.createElement('div');
        variant.className = 'variant';

        for (let d = 0; d < dropsPerVariant; d++) {
          const drop = document.createElement('div');
          drop.className = 'drop';
          drop.textContent = kanas[Math.floor(Math.random() * kanas.length)];
          variant.appendChild(drop);
        }

        column.appendChild(variant);
      }

      return column;
    }

    for (let w = 0; w < numWalls; w++) {
      const wall = document.createElement('div');
      wall.className = 'wall';
      wall.style.setProperty('--wi', w - 3);
      wall.style.setProperty('--wall-index', w + 1);
      wall.style.setProperty('--wall-random', randDec());

      for (let i = 0; i < Math.min(numColumns, maxColumnsPerWall); i++) {
        const column = spawnColumn(i);
        wall.appendChild(column);
      }

      walls.appendChild(wall);
    }

    // Gradually add new columns at interval (fade management)
    setInterval(() => {
      document.querySelectorAll('.wall').forEach(wall => {
        if (wall.children.length < maxColumnsPerWall) {
          const column = spawnColumn();
          wall.appendChild(column);
        } else {
          wall.removeChild(wall.firstElementChild);
          const column = spawnColumn();
          wall.appendChild(column);
        }
      });
    }, 2000); // every 2 seconds
  </script>
</body>
</html>
